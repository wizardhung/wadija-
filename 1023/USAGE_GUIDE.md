# 台語TTS網頁介面使用指南

## 功能說明

本網頁介面提供兩個主要功能：

### 1. 華語轉台語羅馬字 (TLPA)
- **輸入**: 華語文本（例如：我今天真歡喜，因為我的電腦問題解決矣！）
- **輸出**: 台語羅馬字（例如：gua2 kin1 tsiann5 tsin1 huann7 hi2）
- **應用**: 將華語文本轉換為標準的台語羅馬字表記法

### 2. 台語數字調語音合成
- **輸入**: 台語數字調文本（例如：gua2 tsiann5 tsiok4 huann7 hi2）
- **輸出**: 生成的語音檔案，可直接在網頁上試聽
- **應用**: 將台語數字調轉換為自然語音，支援直接播放

## 使用步驟

### 步驟1: 啟動API服務

```bash
cd /home/wizard/專題tts/1023
python translation_api.py
```

輸出應該顯示：
```
正在載入 Fairseq Transformer 模型...
模型載入成功。服務已就緒。
正在載入 TTS Synthesizer 模型...
TTS Synthesizer 載入成功。
 * Running on http://0.0.0.0:5000
```

### 步驟2: 打開網頁介面

在瀏覽器中開啟 `index.html` 檔案

### 步驟3: 使用華語轉台語功能

1. 在「輸入華語文本」區域輸入華語文本
2. 點擊「開始翻譯」按鈕
3. 等待結果顯示在「翻譯結果 (TLPA)」區域

### 步驟4: 使用台語語音合成功能

1. 在「輸入台語數字調文本」區域輸入台語數字調
2. 點擊「開始合成語音」按鈕
3. 等待語音生成（可能需要30秒至1分鐘）
4. 生成完成後，在「台語語音輸出」區域會出現音檔播放器
5. 點擊播放按鈕試聽生成的語音

## 台語數字調格式說明

台語數字調是一種標準的台語拼音表記法：
- 每個音節由「聲母（輔音）」、「韻母（元音）」和「聲調」組成
- 聲調用數字 1-8 表示（某些方言可能有7-9個聲調）
- 音節之間用空格分隔

### 範例
- `gua2` = 「我」（第2聲）
- `tsiann5` = 「清」（第5聲）
- `tsiok4` = 「慾」（第4聲）

## 常見問題

### 問題1: 連線無法連接到API
**解決方案**: 確保 `translation_api.py` 已在終端執行，且未出現錯誤訊息

### 問題2: TTS合成非常慢
**原因**: 首次合成需要載入大型神經網路模型（Tacotron2和WaveGlow），可能需要30秒至1分鐘
**解決方案**: 耐心等待，或檢查系統是否有GPU支援（如有CUDA環境會加快速度）

### 問題3: 語音質量不佳
**可能原因**: 
- 輸入的台語數字調格式不正確
- 輸入的音節不在訓練資料中

**解決方案**: 確保使用正確的台語數字調表記法

## API端點

### POST /translate
- **功能**: 華語文本轉台語羅馬字
- **請求體**: `{"text": "華語文本"}`
- **回應**: `{"original_text": "...", "tlpa_result": "..."}`

### POST /synthesize_tonal_number
- **功能**: 台語數字調語音合成
- **請求體**: `{"text": "台語數字調文本"}`
- **回應**: `{"tonal_number_text": "...", "audio_data": "base64編碼的WAV檔案", "status": "success"}`

## 注意事項

1. **首次運行**: 首次啟動API服務時，模型載入可能需要2-3分鐘，請耐心等待
2. **GPU支援**: 如果系統有CUDA GPU，TTS合成會明顯加快
3. **多個請求**: 建議一次只執行一個合成請求，避免系統過載
4. **檔案清理**: API會自動清理臨時音檔，無需手動清理

## 技術細節

### 模型使用
- **翻譯模型**: Fairseq Transformer（預訓練漢字到台語羅馬字轉換）
- **TTS模型**: Tacotron2 + WaveGlow（台語語音合成）

### 支援的Python版本
- Python 3.7+

### 必要的Python套件
- flask
- flask-cors
- torch
- fairseq
- scipy
- numpy

## 文件結構

```
1023/
├── index.html                 # 網頁介面
├── translation_api.py         # API伺服器（本文修改）
├── c2t/                       # 翻譯模型檔案
└── USAGE_GUIDE.md            # 本文檔

../taiwanese_tonal_tlpa_tacotron2_hsien1/
├── tacotron2/                # Tacotron2模型
│   ├── model/
│   │   ├── checkpoint_100000       # Tacotron2權重
│   │   └── waveglow/
│   │       └── waveglow_main.pt    # WaveGlow權重
│   └── ...
├── han2tts.py                # TTS合成模組
└── ...
```

## 支援

如有問題，請檢查：
1. API伺服器是否正確啟動
2. 模型檔案是否完整存在
3. 瀏覽器主控台是否有錯誤訊息（按F12開啟開發者工具）
4. 網路連線是否正常
